SHELL = /bin/sh
@SET_MAKE@

.SUFFIXES:
.SUFFIXES: .c .o .ads .adb .ali

.PHONY:
.PHONY: clean-generic mostlyclean-generic \
	clean distclean mostlyclean maintainer-clean \
	force

target  = testgtk
src_dir = ../src

CC = @CC@
GTKADA_CONFIG=gtkada-config
GNATFLAGS = @CFLAGS@ -gnata
GNATFLAGS_DEVEL = @CFLAGS@ -g -gnatawu

GNATMAKE = gnatmake
GNATMAKELDFLAGS = -largs -L$(src_dir) -lgtkada @GTK_LIBS@

CP = cp -f

## This variable should be set to "True" if the opengl directories
## have been installed on the system.
HAVE_OPENGL=@HAVE_OPENGL@


ifeq ($(HAVE_OPENGL),True)
OPENGL_C_OBJECTS=lw.o
OPENGL_LIBS= @GL_LIBS@
else
OPENGL_C_OBJECTS=
OPENGL_LIBS=
endif

all: opengl/view_gl.adb $(OPENGL_C_OBJECTS) $(target) 

$(target)::
	@echo "-------------------------------------"
	@echo $(GNATMAKE) $(GNATFLAGS) $(target) '`'$(GTKADA_CONFIG)'`'
	@echo "-------------------------------------"
	@if [ -f $(src_dir)/.devel ]; then \
	   $(GNATMAKE) $(GNATFLAGS_DEVEL) $(target) -I$(src_dir) -Iopengl -aO$(src_dir)/lib-obj -largs $(GNATMAKELDFLAGS) $(OPENGL_C_OBJECTS) $(OPENGL_LIBS); \
	else \
	   $(GNATMAKE) $(GNATFLAGS) $(target) -I$(src_dir) -Iopengl -largs $(GNATMAKELDFLAGS) $(OPENGL_C_OBJECTS) $(OPENGL_LIBS); \
	fi

opengl/view_gl.adb::
	@if [ $(HAVE_OPENGL) = "True" ]; then \
	   $(CP) opengl/view_gl.adb_opengl opengl/view_gl.adb; \
	else \
	   $(CP) opengl/view_gl.adb_no_opengl opengl/view_gl.adb; \
	fi
	   

lw.o: opengl/lw.c opengl/lw.h
	$(CC) -c opengl/lw.c -Iopengl @GTK_CFLAGS@

install:
	@echo "Nothing to do --  just run the ./testgtk program"

clean:
	-${RM} *.o *.ali *~ testgtk b_testgtk.c b~testgtk.ad? core
	-${RM} opengl/view_gl.adb
	-${RM} .\#*

distclean: clean
	-${RM} Makefile

mostlyclean: clean
	-${RM} Makefile

maintainer-clean: clean
	-${RM} Makefile

force:

