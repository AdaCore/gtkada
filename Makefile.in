SHELL=/bin/sh

.SUFFIXES:
.PHONY: clean-generic mostlyclean-generic \
	clean distclean mostlyclean maintainer-clean \
	install src tests

src_dir     = src
testgtk_dir = testgtk
doc_dir     = docs
example_dir = examples
projects_dir = projects
xml_dir      = xml

all: src tests

src:
	$(MAKE) -C $(src_dir)

tests: src
	$(MAKE) -C $(testgtk_dir)

install: 
	$(MAKE) -C $(src_dir) install
	$(MAKE) -C $(projects_dir) install
	$(MAKE) -C $(testgtk_dir) install
	$(MAKE) -C $(doc_dir) install
	#$(MAKE) -C $(example_dir) install
	$(MAKE) -C $(xml_dir) install
	@echo '------------------------------------------------------------------'
	@echo '--  GtkAda has now been installed.                              --'
	@echo '--  To be able to use the library, you may need to update your  --'
	@echo '--  LD_LIBRARY_PATH or to run ldconfig. You may also need to    --'
	@echo '--  update your PATH to include gtkada-config in it.            --'
	@echo '------------------------------------------------------------------'

.PHONY: docs
docs:
	$(MAKE) -C docs


# Generate the binding automatically, through a python script
generate: force
	${RM} src/generated/*.ad?
	python contrib/binding.py \
	   --gir-file=contrib/GLib-2.0.gir \
	   --gir-file=contrib/GObject-2.0.gir \
		--gir-file=contrib/Gtk-3.0.gir \
		--gir-file=contrib/Gdk-3.0.gir \
		--gir-file=contrib/Pango-1.0.gir \
		--gir-file=contrib/Gio-2.0.gir \
		--xml-file=contrib/binding.xml \
		--ada-output=src/generated/tmp.ada \
		--c-output=src/misc_generated.c
	cd src/generated; gnatchop -gnat05 -q -w tmp.ada

clean-generic:
	-${RM} core
	-${RM} .\#*

mostlyclean-generic: clean-generic
	-${RM} Makefile

clean: clean-generic
	-$(MAKE) -C $(testgtk_dir) clean
	#-$(MAKE) -C $(example_dir) clean
	-$(MAKE) -C $(src_dir) clean

distclean: mostlyclean-generic
	-${RM} config.cache config.log config.status
	-$(MAKE) -C $(testgtk_dir) distclean
	-$(MAKE) -C $(src_dir) distclean

mostlyclean: mostlyclean-generic
	-$(MAKE) -C $(testgtk_dir) mostlyclean
	-$(MAKE) -C $(src_dir) mostlyclean

maintainer-clean: mostlyclean-generic
	-${RM} config.cache config.log config.status
	-${RM} configure
	-$(MAKE) -C $(testgtk_dir) maintainer-clean
	-$(MAKE) -C $(src_dir) maintainer-clean

force:
