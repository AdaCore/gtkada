2012-01-06	Nicolas Setton	<setton@adacore.com>

	* gtkimcontextsimple.c (gtk_im_context_simple_filter_keypress): Do not
	discard key events with state CTRL + ALT, as some keyboards do use this
	key combination for legitimate character input.
	* gdkevents-win32.c(build_key_event_state): Detect CTRL + ALT as an
	equivalent group to ALT_GR.
	For K517-001.

2011-11-30	Arnaud Charlet  <charlet@adacore.com>

	* gdk/win32/gdkpixmap-win32.c (_gdk_pixmap_new): Add fallback code
	for 16bits depth display.

2011-07-26	Nicolas Setton  <setton@adacore.com>

	* gtk/gtkimcontextsimple.c (check_win32_special_cases): Fix handling
	of special cases for dead acute and dead diaeresis under Win32. For
	these characters followed by a space, emit an apostrophe and double
	quotes respectively.
	Submitted at https://bugzilla.gnome.org/show_bug.cgi?id=655357

2011-07-22	Arnaud Charlet  <charlet@adacore.com>

	* gdk/win32/gdkdisplay-win32.c (inner_clipboard_window_procedure): Fix
	build with --disable-debug

2011-04-10      Arnaud Charlet  <charlet@adacore.com>

	* modules/engines/ms-windows/msw_style.c (draw_tab_button): Always use
	custom code to draw tab.
	Submitted at https://bugzilla.gnome.org/show_bug.cgi?id=647461

2010-02-01      Arnaud Charlet  <charlet@adacore.com>

	* gdk/win32/gdkdrawable-win32.c	(draw_segments): Ignore LineTo
	errors.

2009-07-20	Arnaud Charlet	<charlet@adacore.com>

	* configure: Work around ^M handling on cygwin with igncr

2006-06-05	Arnaud Charlet	<charlet@adacore.com>

	* gdk/win32/gdkgc-win32.c (_gdk_win32_gdkregion_to_hrgn): Disable
	harmless warning which is occurring often with Gtk+ >= 2.8.18

2002-11-25	Arnaud Charlet	<charlet@adacore.com>

	* gdk/Makefile.in: Remove gdk-win32res.o dependency,
	since we do not want to use the default Gtk+ icon.

--- gdk/Makefile.in.orig	2010-09-23 16:27:22.000000000 +0200
+++ gdk/Makefile.in	2010-10-08 11:06:41.724000000 +0200
@@ -664,8 +664,8 @@ libgdk_quartz_2_0_la_LIBADD = quartz/lib
 libgdk_quartz_2_0_la_LDFLAGS = $(LDADD)
 libgdk_win32_2_0_la_SOURCES = $(common_sources) gdkkeynames.c
 libgdk_win32_2_0_la_LIBADD = win32/libgdk-win32.la $(GDK_DEP_LIBS)
-libgdk_win32_2_0_la_DEPENDENCIES = win32/libgdk-win32.la win32/rc/gdk-win32-res.o gdk.def
-libgdk_win32_2_0_la_LDFLAGS = -Wl,win32/rc/gdk-win32-res.o -export-symbols $(srcdir)/gdk.def $(LDADD)
+libgdk_win32_2_0_la_DEPENDENCIES = win32/libgdk-win32.la gdk.def
+libgdk_win32_2_0_la_LDFLAGS = -export-symbols $(srcdir)/gdk.def $(LDADD)
 @HAVE_INTROSPECTION_TRUE@introspection_files = $(filter-out \
 @HAVE_INTROSPECTION_TRUE@	gdkkeysyms-compat.h, \
 @HAVE_INTROSPECTION_TRUE@	$(gdk_public_h_sources)) \
--- gdk/win32/gdkgc-win32.c.orig
+++ gdk/win32/gdkgc-win32.c	2006-06-05 14:56:59.515625000 +0200
@@ -1160,8 +1160,7 @@ _gdk_win32_gdkregion_to_hrgn (GdkRegion 
       if (rect->bottom > rgndata->rdh.rcBound.bottom)
 	rgndata->rdh.rcBound.bottom = rect->bottom;
     }
-  if ((hrgn = ExtCreateRegion (NULL, nbytes, rgndata)) == NULL)
-    WIN32_API_FAILED ("ExtCreateRegion");
+  hrgn = ExtCreateRegion (NULL, nbytes, rgndata);
 
   g_free (rgndata);
 
--- configure.old	2009-02-23 15:54:03.650263500 +0100
+++ configure	2009-02-23 15:54:54.711263500 +0100
@@ -36969,6 +36971,7 @@ if test "$ac_cs_awk_cr" = "a${ac_cr}b"; 
 else
   ac_cs_awk_cr=$ac_cr
 fi
+ac_cs_awk_cr=$ac_cr
 
 echo 'BEGIN {' >"$tmp/subs1.awk" &&
 _ACEOF
--- gdk/win32/gdkdrawable-win32.c.old	2010-01-31 18:48:07.679800000 +0100
+++ gdk/win32/gdkdrawable-win32.c	2010-01-31 18:48:32.429800000 +0100
@@ -1246,7 +1246,7 @@ draw_segments (GdkGCWin32 *gcwin32,
 
 	  GDK_NOTE (DRAW, g_print (" +%d+%d..+%d+%d", x1, y1, x2, y2));
 	  GDI_CALL (MoveToEx, (hdc, x1, y1, NULL)) &&
-	    GDI_CALL (LineTo, (hdc, x2, y2));
+	    LineTo (hdc, x2, y2);
 	}
 
       GDK_NOTE (DRAW, g_print ("\n"));
--- modules/engines/ms-windows/msw_style.c.old
+++ modules/engines/ms-windows/msw_style.c
@@ -2590,7 +2590,9 @@ draw_tab_button (GtkStyle *style,
 		 const gchar *detail,
 		 gint x, gint y, gint width, gint height, gint gap_side)
 {
+#if 0
   if (gap_side == GTK_POS_TOP || gap_side == GTK_POS_BOTTOM)
+#endif
     {
       /* experimental tab-drawing code from mozilla */
       RECT rect;
--- gdk/win32/gdkdisplay-win32.c.old	2011-07-22 12:06:42.618000000 +0200
+++ gdk/win32/gdkdisplay-win32.c	2011-07-22 12:07:29.311000000 +0200
@@ -386,7 +386,7 @@ inner_clipboard_window_procedure (HWND  
         if (_gdk_debug_flags & GDK_DEBUG_DND)
           {
             while ((nFormat = EnumClipboardFormats (nFormat)) != 0)
-              g_print ("%s ", _gdk_win32_cf_to_string (nFormat));
+              GDK_NOTE (DND, g_print ("%s ", _gdk_win32_cf_to_string (nFormat)));
           }
 
         GDK_NOTE (DND, g_print (" \n"));
--- gtk/gtkimcontextsimple.c.original	2011-07-26 15:59:06.000000000 +0200
+++ gtk/gtkimcontextsimple.c	2011-07-26 16:00:44.000000000 +0200
@@ -302,9 +302,9 @@ check_win32_special_cases (GtkIMContextS
       switch (context_simple->compose_buffer[0])
 	{
 	case GDK_dead_acute:
-	  value = 0x00B4; break;
+	  value = 0x0027; break;
 	case GDK_dead_diaeresis:
-	  value = 0x00A8; break;
+	  value = 0x0022; break;
 	}
       if (value > 0)
 	{
--- gdk/win32/gdkpixmap-win32.c.old	2011-11-10 18:38:03.000000000 +0100
+++ gdk/win32/gdkpixmap-win32.c	2011-11-30 16:15:45.976000000 +0100
@@ -175,6 +175,10 @@ _gdk_pixmap_new (GdkDrawable *drawable,
       format = CAIRO_FORMAT_A8;
       break;
 
+    case 16:
+      g_warning ("_gdk_pixmap_new: depth = %d, falling back to 24", depth);
+      /* fallthrough */
+
     case 24:
     case 32:
       format = CAIRO_FORMAT_RGB24;
--- gtk/gtkimcontextsimple.c.orig	2012-01-06 16:45:26.000000000 +0100
+++ gtk/gtkimcontextsimple.c	2012-01-06 16:46:25.000000000 +0100
@@ -877,7 +877,7 @@ gtk_im_context_simple_filter_keypress (G
 	    event->keyval == GDK_ISO_Enter ||
 	    event->keyval == GDK_KP_Enter)))
 	{
-	  return FALSE;
+	  return no_sequence_matches (context_simple, n_compose, event);
 	}
     }
   
*** gdk/win32/gdkevents-win32.c.orig	2012-01-06 16:46:38.000000000 +0100
--- gdk/win32/gdkevents-win32.c	2012-01-06 16:47:13.000000000 +0100
***************
*** 671,676 ****
--- 671,679 ----
  	event->key.state |= GDK_CONTROL_MASK;
        if (key_state[VK_MENU] & 0x80)
  	event->key.state |= GDK_MOD1_MASK;
+ 
+       if ((key_state[VK_CONTROL] & 0x80) && (key_state[VK_MENU] & 0x80))
+         event->key.group = 1;
      }
  }
  
