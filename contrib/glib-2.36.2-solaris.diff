2013-01-08	Nicolas Setton  <setton@adacore.com>

	* (Makefile.in, glib/Makefile.in): Deactivate make in tests,
	not working because of an obscure C99 incompatibility on
	sparc64-solaris.

2013-05-16	Albert Lee <lee@adacore.com>

	* (Makefile.in, glib/Makefile.in, gobject/Makefile.in):
	Redo patch, also including gobject/Makefile.in.

	* (configure): Define "#define _XOPEN_SOURCE 600" to help
	with C99 issues.

	* (./gio/glocalfile.c): Fix: bad location for declaration of
	statfs_result variable.

--- ./glib/Makefile.in.orig	Mon May 13 08:28:39 2013
+++ ./glib/Makefile.in	Thu May 16 11:09:21 2013
@@ -62,7 +62,7 @@
 	$(srcdir)/glib.rc.in $(dist_gdb_SCRIPTS) $(top_srcdir)/depcomp \
 	$(deprecatedinclude_HEADERS) $(glibinclude_HEADERS) \
 	$(glibsubinclude_HEADERS)
-@BUILD_MODULAR_TESTS_TRUE@am__append_1 = tests 
+@BUILD_MODULAR_TESTS_TRUE@am__append_1 =
 @OS_UNIX_TRUE@am__append_2 = glib-unix.c
 @OS_WIN32_TRUE@am__append_3 = gthread-win32.c
 @OS_WIN32_FALSE@am__append_4 = gthread-posix.c
@@ -635,7 +635,7 @@
 @USE_SYSTEM_PCRE_FALSE@MAYBE_PCRE = pcre 
 SUBDIRS = libcharset $(PRINTF_SUBDIR) $(MAYBE_PCRE) update-pcre . \
 	$(am__append_1)
-DIST_SUBDIRS = libcharset gnulib pcre update-pcre tests
+DIST_SUBDIRS = libcharset gnulib pcre update-pcre
 AM_CPPFLAGS = \
 	$(glib_INCLUDES) 		\
 	$(pcre_inc) 			\
--- ./gobject/Makefile.in.orig	Mon May 13 08:28:39 2013
+++ ./gobject/Makefile.in	Thu May 16 11:10:01 2013
@@ -61,7 +61,7 @@
 	$(srcdir)/glib-mkenums.in $(srcdir)/makefile.msc.in \
 	$(srcdir)/gobject.rc.in $(dist_gdb_SCRIPTS) \
 	$(top_srcdir)/depcomp $(libgobjectinclude_HEADERS) ChangeLog
-@BUILD_MODULAR_TESTS_TRUE@am__append_1 = tests 
+@BUILD_MODULAR_TESTS_TRUE@am__append_1 =
 @ENABLE_DTRACE_TRUE@am__append_2 = gobject_probes.h gobject_probes.o
 @ENABLE_DTRACE_TRUE@am__append_3 = gobject_probes.h
 @ENABLE_DTRACE_TRUE@am__append_4 = gobject_probes.o
@@ -230,7 +230,7 @@
   done | $(am__uniquify_input)`
 ETAGS = etags
 CTAGS = ctags
-DIST_SUBDIRS = . tests
+DIST_SUBDIRS = .
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 am__relativize = \
   dir0=`pwd`; \
--- ./configure.orig	Thu May 16 06:49:32 2013
+++ ./configure	Thu May 16 10:22:36 2013
@@ -23771,7 +23771,7 @@
 $as_echo "#define _XOPEN_SOURCE_EXTENDED 1" >>confdefs.h
 
 
-$as_echo "#define _XOPEN_SOURCE 2" >>confdefs.h
+$as_echo "#define _XOPEN_SOURCE 600" >>confdefs.h
 
 
 $as_echo "#define __EXTENSIONS__ 1" >>confdefs.h
--- ./Makefile.in.orig	Mon May 13 08:28:36 2013
+++ ./Makefile.in	Thu May 16 11:10:22 2013
@@ -66,8 +66,8 @@
 	$(srcdir)/README.in $(srcdir)/config.h.win32.in test-driver \
 	COPYING compile config.guess config.sub depcomp install-sh \
 	missing py-compile ltmain.sh
-@BUILD_MODULAR_TESTS_TRUE@am__append_1 = tests 
-@BUILD_MODULAR_TESTS_FALSE@am__append_2 = tests
+@BUILD_MODULAR_TESTS_TRUE@am__append_1 =
+@BUILD_MODULAR_TESTS_FALSE@am__append_2 =
 @OS_UNIX_TRUE@am__append_3 = gio-unix-2.0.pc
 @OS_WIN32_TRUE@am__append_4 = gio-windows-2.0.pc
 subdir = .
--- ./gio/glocalfile.c.orig	2013-02-02 00:19:08.000000000 -0500
+++ ./gio/glocalfile.c	2013-05-16 11:50:23.562449000 -0400
@@ -2422,10 +2422,10 @@
 is_remote_fs (const gchar *filename)
 {
   const char *fsname = NULL;
+  int statfs_result = 0;
 
 #ifdef USE_STATFS
   struct statfs statfs_buffer;
-  int statfs_result = 0;
 
 #if STATFS_ARGS == 2
   statfs_result = statfs (filename, &statfs_buffer);
