This document describes how to transition from GtkAda 2.x to GtkAda 3.x.

General
=======

Gtk+ interfaces no longer require an explicit "with" of the interface
package, and a cast to the interface type (with "-" and "+"). Instead,
each package now contains the list of subprograms inherited from the
various interfaces.

Ada 2005
========

The GtkAda 3 toolkit makes use of Ada 2005.  When transitioning source
code written for an Ada 95 compiler to GtkAda 3, it is not always
necessary to compile your code with GNAT Pro in Ada 2005 mode.  However
you should keep in mind that handling of null values in access types
has changed significantly between the two language revisions.

One symptom of the incompatibility is the following compiler error:

   file.adb:x:y: null is not allowed as argument for an access parameter

Other error messages that are symptomatic of the incompatibility may
resemble the following (the message is referring to a parameter in a
subprogram callback):

   file.adb:x:y: not subtype conformant with declaration at abc.ads:z ...
   file.adb:x:y: type of "Subprogram_Param" does not match

where the types are access types or access to classwide types, etc. that
apparently seem to match.

Fixing the code to accomodate the differences is left mostly as an
exercise for the user, but we can offer a few suggestions.

Of course, if you encounter the "null is not allowed" message you may
replace the null argument with a valid value.

Another possible solution is to compile the user code in Ada 2005 mode
(using compiler options or the "Ada_05" pragma).  This has the effect
of cohering the subtypes between GtkAda and application code.

For the issue with callback subprogram parameters, it may be necessary
to compile in Ada 2005 mode and modify the access type by using
"not null" appropriately, so the callback:

   procedure CB (Widget : access Gtk_Widget_Record'Class);

becomes

   procedure CB (Widget : not null access Gtk_Widget_Record'Class);

Gdk.Bitmap
==========

This package has been removed: Cairo packages should be used for drawing, and
Gdk.Pixbuf for representing image data in memory.

Gdk.Cursor
==========

The Gdk_New function working on Gdk_Pixmap has been removed. Use
 Gdk.Pixbuf.Gdk_New_From_Pixbuf to create a cursor from a pixbuf.

Gdk.Dnd
=======

The functions for handling Drag_Contexts have been moved to new package
Gdk.Drag_Contexts.

The Gdk_Drag_Context itself now inherits from GObject, which means that it no
longer requires its own Ref/Unref functions.

Drag_Find_Window has been removed, use Drag_Find_Window_For_Screen instead.

Drag_Get_Protocol has been replaced with Drag_Context_Get_Protocol.

Gdk.Drawable
============

All Draw_* subprograms have been removed: use Cairo for low-level drawing.

Gdk.Event
=========

Get_Region now returns a Cairo_Region: use Cairo.Region for manipulating
the result.

Set_Requestor/Get_Requestor now work on a Gdk_Window.

The APIs to Get_Message_Type, Set_Message_Type, Get_Data, and Set_Data have
been removed without replacement.

Get_Graphics_Expose and Send_Client_Message have been removed with no
replacement.

Gdk.Font
========

This package has been removed: use Pango.Font for fonts manipulation,
Cairo.Font_Face and Cairo.Font_Options for text rendering.

Gdk.GC
======

This package has been removed: Cairo packages should be used for drawing.

Gdk.Image
=========

This package has been removed: use a Gdk.Pixbuf instead.

Gdk.Main
========

Set_Locale functions are no longer needed and have been removed.

Functions Set_Use_Xshm and Get_Use_Xshm have been removed.

Gdk.Pixbuf
==========

Render_Threshold_Alpha, Render_To_Drawable, Render_To_Drawable_Alpha,
Render_Pixmap_And_Mask, Render_Pixmap_And_Mask_For_Colormap have been removed.

Use APIs provided by Gdk.Cairo to draw a pixbuf on a Gdk_Drawable.

Get_From_Drawable has been removed, use Get_From_Surface or Get_From_Window.

Gdk.Pixmap
==========

This package has been removed: Cairo packages should be used for drawing, and
Gdk.Pixbuf for representing image data in memory.

Gdk.Region
==========

This package has been removed and replaced with Cairo_Region.

Gdk.RGB
=======

This package is deprecated in Gtk3. Use Pixmaps/Cairo for drawing, and
use Gdk.Pixbuf for offscreen image manipulation and rendering to drawables.

Instead of Gdk.Rgb.Get_Cmap, use Gtk.Widget.Get_Default_Colormap.

Gdk.Window
==========

Copy_Area and Set_Back_Pixmap have been removed: use Gdk_Drawable and
Gdk.Cairo functions instead.

Get_Desk_Relative_Origin: this function has been removed without a replacement.

Get_Toplevels has been removed, use Gtk.Window.List_Toplevels instead.

Gdk.Window_Attr
===============

Parameter "Colormap" has been removed from procedure Gdk_New. This parameter
 is no longer needed.

Set_Colormap and Get_Colormap should no longer be needed and have been removed
as well.

Gtk.Action
==========

Block_Activate_From, Unblock_Activate_From, Connect_Proxy, Disconnect_Proxy:
these obsolete subprograms have been removed without a replacement.

Gtk.Aspect_Frame
================

Direct accessors Get_Xalign, Get_Yalign and Get_Ratio have been removed:
instead, use the corresponding properties.

Gtk.Assistant
=============

The values in Gtk_Assistant_Page_Type were renamed for consistency,
removing their Gtk_ prefix.

Gtk.Cell_Layout
===============

Get_Cell_Renderers has been renamed to Get_Cells.

Gtk.Cell_Renderer
=================

The Render subprogram is now called with a Cairo_Context rather than a
Gdk_Window.

Gtk.Cell_View
=============

Get_Cell_Renderers is obsolete, use the Gtk.Cell_Layout interface and
Gtk.Cell_Layout.Get_Cells.

Gtk.Clist
=========

This widget has been removed: use a Gtk.Tree_View instead.

Gtk.Container
=============

Procedure Propagate_Expose has been removed and will be replaced with
Propagate_Draw.

Gtk.Color_Button
================

The function Get_Color returning Gdk.Color.Gdk_Color is now a procedure
with an out parameter.

Gtk.Color_Selection
===================

Get_Color and Set_Color have been removed: use Get_Current_Color and
Set_Current_Color instead.

Gtk.Color_Selection_Dialog
==========================

Subprogram Get_Colorsel has been renamed Get_Color_Selection, to match
the Gtk+ naming.

Get_OK_Button, Get_Cancel_Button, Get_Help_Button have been removed.
Instead, use:
   Gtk_Button (Glib.Properties.Get_Property (Dialog, Ok_Button_Property)),
   Gtk_Button (Glib.Properties.Get_Property (Dialog, Cancel_Button_Property)),
   Gtk_Button (Glib.Properties.Get_Property (Dialog, Help_Button_Property))

Gtk.Combo
=========

This widget has been removed: use a Gtk.Combo_Box instead.

Gtk.Combo_Box
=============

The "text only" variant has been moved to the new package Gtk.Combo_Box_Text.

Gtk.Combo_Box_Entry
===================

This widget has been removed: use a Gtk.Combo_Box instead.

Gtk.Ctree
=========

This widget has been removed: use a Gtk.Tree_View instead.

Gtk.Curve
=========

This widget has been removed, with no direct replacement.  Use drawing
functionality from Cairo instead.

Gtk.Dialog
==========

Subprogram Get_Vbox was replaced with Get_Content_Area.

Gtk.Dnd
=======

Source_Set_Icon now works with a Gdk_Pixbuf.
Set_Icon_Pixmap has been removed: use Set_Icon_Pixbuf instead.
Obsolete Set_Default_Icon working on Gdk.Pixmap has been removed without a
 replacement.

Gtk.Editable
============

The type representing a Gtk_Editable_Record has been changed from a
Widget (which is a GObject) to an Interface (a System.Address).
Therefore the Gtk_Editable_Record type has been eliminated.  User code
referencing only the Gtk_Editable type should function unchanged.

The Select_Region subprogram parameter name The_End has been normalized
to End_Pos.

Gtk.File_Chooser_Button
=======================

Subprograms Gtk_New_With_Backend and Initialize_With_Backend have been
removed: use Gtk_New and Initialize instead.

Gtk.File_Chooser_Dialog
=======================

Subprograms Gtk_New_With_Backend and Initialize_With_Backend have been
removed: use Gtk_New and Initialize instead.

Gtk.File_Chooser_Widget
=======================

Subprograms Gtk_New_With_Backend and Initialize_With_Backend have been
removed: use Gtk_New and Initialize instead.

Gtk.File_Selection
==================

This package has been replaced by Gtk.File_Chooser.
You may also use Gtkada.File_Selection for a simple interface to the
Gtk.File_Chooser.

Gtk.Fixed
=========

Subprograms Set_Has_Windows and Get_Has_Windows are now in Gtk.Widget.

Gtk.Gamma_Curve
===============

This widget has been removed without any replacement.

Gtk.GC
======

This package has been removed: Cairo packages should be used for drawing.

Gtk.GEntry
==========

The names for Gtk_Entry_Record parameters have been normalized across
the board to "The_Entry".

Gtk.HRuler
==========

This widget has been removed without any replacement.

Gtk.Image
=========

The subprograms working with Gdk_Pixmap have been removed, use the
variants working on Gdk_Pixbuf instead.

Gtk.Input_Dialog
================

This package is no longer part of Gtk+, so this binding has been removed
without replacement.

Gtk.Item
========

This obsolete package has been removed with no replacement.

Gtk.Item_Factory
================

This obsolete package has been removed in favor of Gtk.UI_Manager.

Gtk.Layout
==========

Get_Width and Get_Height have been removed, use Get_Size instead.

Gtk.Link_Button
===============

All widget parameter names have been normalized to "Self".

The Set_Uri_Hook function has been eliminated, and along with it the
Uri_Func type and the Generic_Uri_Hook package.  Register a callback
for the button's "clicked" signal instead.

Gtk.List_Item
=============

This widget has been removed: use a Gtk.Tree_View instead.

Gtk.Menu_Item
=============

For subprogram Set_Right_Justified, the parameter "Justify" has been
renamed to "Right_Justified".

The obsolete procedures Remove_Submenu, Set_Right_Justify, and
Right_Justify have been removed.  Instead, use Set_Submenu,
Set_Right_Justified, or Set_Right_Justified with Justify = True,
respectively.

Calling Gtk_New with one Menu_Item argument has the same effect now
as before.  However, from this version on, if a Label argument exists
(even if set to ""), a Gtk_Label child will be created with the given
value.

Gtk.Menu_Tool_Button
====================

Set_Arrow_Tooltip has been removed, use Set_Arrow_Tooltip_Markup or
Set_Arrow_Tooltip_Text instead.

Gtk.Main
========

The Quit package has been removed without replacement.

The Idle and Timeout handling been removed: use equivalent functions in
package Glib.Main instead.

Gtk.Notebook
============

Get_Children has been removed: call Gtk.Container.Get_Children instead.

Gtk.List
========

This package has been removed: use a Gtk_Tree_View instead.

Gtk.Object
==========

Gtk.Object has been removed in Gtk+-3.

The following subprograms and declarations are now in Gtk.Widget:

    Flags
    Unset_Flags

    Floating
    In_Destruction_Is_Set

    Signal_Destroy

The subprogram Gtk.Object.Sink has been removed: use Glib.Object.Ref_Sink
 instead.

Gtk.Old_Editable
================

This obsolescent API has been removed, use Gtk.Editable where relevant.

Gtk.Option_Menu
===============

Gtk.Option_Menu has been removed.  Using Gtk.Combo_Box instead is
recommended.

Gtk.Pixmap
==========

This widget has been removed and is generally replaced with a Gtk.Image.

Gtk.Preview
===========

This widget has been removed without replacement.

Gtk.Progress
============

This widget has been removed without any replacement.

Gtk.Progress_Bar
================

This widget is now derived from Gtk.Widget directly, rather than from
Gtk.Progress (which has been removed).

The enumeration type Gtk_Progress_Bar_Orientation has been removed,
and this widget now implements the Gtk_Orientable interface.  To fully
achieve the same functionality as the GtkAda 2.x Get_Orientation/
Set_Orientation subprograms, it is now necessary to call
Get_Orientation/Set_Orientation along with Get_Inverted/Set_Inverted.

Procedure Set_Pulse_Step's "Step" parameter has been renamed to "Formal."

Set_Ellipsize and Get_Ellipsize parameter names have been normalized
from "Pbar" to "Progress_Bar".

Gtk.Ruler
=========

This widget has been removed without any replacement.

Gtk.Status_Icon
===============

Status_Icon widget parameter names have been normalized to "Status_Icon".

Get_Blinking and Set_Blinking have been removed, it is no longer possible to
make the status icon blink.

Gtk.Style
=========

All functions based on Gdk.GC or Gdk.Pixmap have been removed.
Use functions in Gtk.Style_Context instead.

A number of drawing functions have been removed: use the Paint_* functions
instead.

Gtk.Text
========

This obsolescent API has been removed: use a Gtk.Text_View/Gtk.Text_Buffer
instead.

Gtk.Text_Attributes
===================

Set_Fg_Stipple, Get_Fg_Stipple, Set_Bg_Stipple, Get_Bg_Stipple have been
removed without a replacement.

Gtk.Text_View
=============

The functions Get/Set_Disable_Scroll_On_Focus have no effect in recent
versions of Gtk+ and have been removed.

Gtk.Tree_View_Column
====================

Get_Cell_Renderers is obsolete, use the Gtk.Cell_Layout interface and
Gtk.Cell_Layout.Get_Cells.

Gtk.Tips_Query
==============

This obsolete package has been removed.

Gtk.Tool_Item
=============

Set_Tooltip has been removed: use Set_Tooltip_Text and Set_Tooltip_Markup
instead.

Gtk.Toolbar
===========

All Gtk_Toolbar widget parameter names have been normalized to "Toolbar".

Subprograms Append_*, Prepend_* and Insert_* have been removed: use Insert
instead.

Subprograms Get_Tooltips/Set_Tooltips have been removed.  Use the
Gtk_Enable_Tooltips property instead.

Gtk.Tooltips
============

The package Gtk.Tooltips has been removed, in favor of Gtk.Tooltip.

For creating simple tooltips on all GtkAda widgets, the easiest is to use
Gtk.Widget.Set_Tooltip_Text or Gtk.Set_Tooltip_Markup.

Gtk.Tree_View
=============

Procedure Create_Row_Drag_Icon now returns a Cairo_Surface.

Get_Hadjustment, Set_Hadjustment, Get_Vadjustment, Set_Vadjustment have been
removed: use the equivalent properties.

Widget_To_Tree_Coords and Tree_To_Widget_Coords have been removed: use
Convert_Widget_To_Tree_Coords and Convert_Tree_To_Widget_Coords.

Gtk.VRuler
==========

This widget has been removed without any replacement.

Gtk.Widget
==========

Function Get_Snapshot has been removed without a replacement.

Hide_All has been removed: use Hide instead.

Set_Extension_Events and End_Extension_Events are no longer needed and have
been removed.

Set_Colormap and Get_Colormap are no longer needed and have been removed.

Set_Scroll_Adjustments has been removed without a replacement.

Shape_Combine_Mask, Input_Shape_Combine_Mask and Reset_Shapes have been removed
without replacements.

Set_Uposition has been removed: use the properties of the containing widget
to fix the position of contained widgets. The functions in Gtk.Window, for
instance Gtk.Window.Move, should be used for top-level widgets.

Set_USize has been removed: use Set_Size_Request instead.

Queue_Clear and Queue_Clear_Area have been removed, call Queue_Draw and
Queue_Draw_Area instead.

Gtk.Window
==========

Set_Has_Frame, Get_Has_Frame, Set_Frame_Dimensions, Get_Frame_Dimensions:
these special-purpose subprograms have been removed without replacement.

Get_Gravity, Set_Gravity: these have been removed, use the property
Gravity_Property instead.

Gnome.App_Bar
=============

Subprogram Appbar_Get_Progress has been removed without replacement.

Gnome.Gentry
============

This package has been removed without replacement.
